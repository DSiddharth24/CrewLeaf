generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  super_admin
  club_admin
  viewer
}

enum PaymentStatus {
  pending
  paid
  failed
}

model User {
  id           String   @id @default(uuid())
  name         String
  email        String   @unique
  phone        String?
  passwordHash String
  role         Role     @default(viewer)
  collegeName  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  clubs        Club[]   @relation("ClubOwner")
}

model Club {
  id           String   @id @default(uuid())
  name         String
  description  String?
  logoUrl      String?
  collegeName  String?
  ownerUserId  String
  owner        User     @relation("ClubOwner", fields: [ownerUserId], references: [id])
  events       Event[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Event {
  id                String   @id @default(uuid())
  clubId            String
  club              Club     @relation(fields: [clubId], references: [id])
  title             String
  slug              String   @unique
  description       String?
  posterUrl         String?
  venue             String?
  city              String?
  state             String?
  startDateTime     DateTime
  endDateTime       DateTime
  registrationOpen  DateTime
  registrationClose DateTime
  feeINR            Int
  maxParticipants   Int?
  isPublic          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  registrations     Registration[]
  sponsors          Sponsor[]
  certificateTemplate CertificateTemplate?
  certificatesIssued CertificateIssued[]
}

model Registration {
  id                   String        @id @default(uuid())
  eventId              String
  event                Event         @relation(fields: [eventId], references: [id])
  name                 String
  email                String
  phone                String?
  collegeName          String?
  branch               String?
  year                 String?
  paymentStatus        PaymentStatus @default(pending)
  stripeSessionId      String?
  stripePaymentIntentId String?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  certificateIssued    CertificateIssued?
}

model Sponsor {
  id                String   @id @default(uuid())
  eventId           String
  event             Event    @relation(fields: [eventId], references: [id])
  name              String
  contactPerson     String?
  contactPhone      String?
  contactEmail      String?
  committedAmountINR Int     @default(0)
  receivedAmountINR  Int     @default(0)
  logoUrl           String?
  notes             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model CertificateTemplate {
  id                  String   @id @default(uuid())
  eventId             String   @unique
  event               Event    @relation(fields: [eventId], references: [id])
  title               String
  backgroundImageUrl  String?
  signatureLeftName   String?
  signatureLeftRole   String?
  signatureLeftImageUrl String?
  signatureRightName  String?
  signatureRightRole  String?
  signatureRightImageUrl String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model CertificateIssued {
  id                 String       @id @default(uuid())
  eventId            String
  event              Event        @relation(fields: [eventId], references: [id])
  registrationId     String       @unique
  registration       Registration @relation(fields: [registrationId], references: [id])
  certificateNumber  String       @unique
  pdfUrl             String?
  issuedAt           DateTime     @default(now())
  createdAt          DateTime     @default(now())
}
